<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>í•œêµ­ì„ìœ ê´€ë¦¬ì› AI ARS ì‹œì—° ì‹œìŠ¤í…œ</title>

  <style>
    body {
      font-family: "Pretendard", sans-serif;
      margin: 0;
      padding: 0;
      background: url("./bg_kpetro_head.png") no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      color: #002f6c;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      text-align: center;
      padding-top: 40px;
    }

    .logo {
      width: 90%;
      max-width: 480px;
      mix-blend-mode: multiply;
      margin-bottom: 16px;
    }

    .start-btn {
      background: #ffffffcc;
      padding: 14px 24px;
      border-radius: 14px;
      font-size: 18px;
      font-weight: 700;
      border: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      margin-bottom: 30px;
      cursor: pointer;
    }

    .chat-box {
      background: rgba(255,255,255,0.68);
      backdrop-filter: blur(4px);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      width: 90%;
      max-width: 500px;
      padding: 20px;
      min-height: 260px;
      text-align: left;
      overflow-y: auto;
      display: none;
    }

    .msg {
      background: rgba(230,240,255,0.85);
      border-radius: 12px;
      padding: 10px 14px;
      margin: 10px 0;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .btn {
      display: inline-block;
      background: rgba(255,255,255,0.65);
      color: #003366;
      border: 1.8px solid rgba(255,255,255,0.75);
      border-radius: 12px;
      padding: 10px 18px;
      margin: 8px 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.25s ease;
      backdrop-filter: blur(6px);
      text-shadow: 0 1px 1px rgba(255,255,255,0.4);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    .btn:hover {
      background: rgba(255,255,255,0.85);
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
    }

    .input-area {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-top: 12px;
    }

    .input-area input {
      width: 100%;
      max-width: 460px;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 15px;
    }

    .character {
      position: fixed;
      bottom: 8px;
      right: 10px;
      width: 130px;
      opacity: 0.95;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
  </style>
</head>

<body>

<img src="./kpetro_logo.png" class="logo" />
<button id="startBtn" class="start-btn">â–¶ ì‹œì‘í•˜ê¸°</button>

<div class="chat-box" id="chatBox"></div>
<div id="btnArea"></div>

<div class="input-area" id="inputArea">
  <input type="text" id="userName" placeholder="ì„±ëª… ì…ë ¥" />
  <input type="text" id="userPhone" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥" />
  <input type="text" id="userAddress" placeholder="ì£¼ì†Œ ì…ë ¥" />
</div>

<img src="./bg_kpetro_yubanjang.png" class="character" />

<script>
/* -------------------- ê³µí†µ í•¨ìˆ˜ --------------------- */

function say(text){
  return new Promise(res=>{
    const d=document.createElement("div");
    d.className="msg";
    d.textContent=text;
    document.getElementById("chatBox").appendChild(d);
    d.scrollIntoView({behavior:"smooth"});
    setTimeout(res, 300);
  });
}

function playAudio(file){
  return new Promise(res=>{
    const a=new Audio("./audio/"+file);
    a.volume=0.43;
    a.onended = res;
    a.onerror = res;
    a.play().catch(res);
  });
}

function btn(text,fn){
  const b=document.createElement("button");
  b.className="btn";
  b.textContent=text;
  b.onclick=fn;
  return b;
}

function showButtons(arr){
  const area=document.getElementById("btnArea");
  area.innerHTML="";
  arr.forEach(b=>area.appendChild(b));
}

function clearButtons(){
  document.getElementById("btnArea").innerHTML="";
}

/* -------------------- ìƒíƒœ --------------------- */

const state={region:"", category:"", detail:"", mode:""};
let ringAudio;

/* -------------------- ì‹œì‘ --------------------- */

document.getElementById("startBtn").onclick=async()=>{
  document.getElementById("startBtn").style.display="none";
  document.getElementById("chatBox").style.display="block";

  await say("ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ. í•œêµ­ì„ìœ ê´€ë¦¬ì›ì…ë‹ˆë‹¤.");
  await playAudio("intro.mp3");

  await say("ì›í•˜ì‹œëŠ” ì—…ë¬´ë¥¼ ìœ„í•´ ë¨¼ì € ì§€ì—­ì„ ë§ì”€í•´ì£¼ì„¸ìš”.");
  await playAudio("region_guide.mp3");

  showRegion();
};

/* ----------------- ì§€ì—­ ì„ íƒ ----------------- */

function showRegion(){
  showButtons([
    btn("AAì§€ì—­", ()=>selectRegion("AA")),
    btn("00ì§€ì—­", ()=>selectRegion("00"))
  ]);
}

async function selectRegion(r){
  clearButtons();
  state.region=r;

  await say(`${r}ì§€ì—­ìœ¼ë¡œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  await playAudio(r==="AA" ? "region_AA.mp3" : "region_00.mp3");

  await say("ì ‘ìˆ˜ ìœ í˜•ì„ ë§ì”€í•´ì£¼ì„¸ìš”.");
  await playAudio("category_guide.mp3");

  showCategory();
}

/* ----------------- ì¹´í…Œê³ ë¦¬ ----------------- */

function showCategory(){
  showButtons([
    btn("ì‹ ê³ Â·ë¯¼ì›", ()=>selectCategory("ì‹ ê³ Â·ë¯¼ì›")),
    btn("ê¸°íƒ€ ë¬¸ì˜", ()=>selectCategory("ê¸°íƒ€ ë¬¸ì˜"))
  ]);
}

async function selectCategory(c){
  clearButtons();
  state.category=c;

  if(c==="ê¸°íƒ€ ë¬¸ì˜"){
    state.detail = "ê¸°íƒ€ ë¬¸ì˜";
    state.mode = "";  // ë©”ì‹ ì €ì—ì„œ ê´„í˜¸ ì•ˆ ë‚˜ì˜¤ê²Œ
    await say("ê¸°íƒ€ ë¬¸ì˜ë¡œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ì ì—°ê²° ì¤‘ì…ë‹ˆë‹¤...");
    await playAudio("etc_intro.mp3");
    startRinging();
    showContactInput();
    return;
  }

  await say("ì‹ ê³ Â·ë¯¼ì›ìœ¼ë¡œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤.");
  await playAudio("report_intro.mp3");

  await say("í•˜ìœ„ ì ‘ìˆ˜ í•­ëª©ì„ ë§ì”€í•´ì£¼ì„¸ìš”.");
  await playAudio("sub_guide.mp3");

  showSub();
}

/* ----------------- í•˜ìœ„ í•­ëª© ----------------- */

function showSub(){
  const list=[
    ["í˜¼í•©ìœ ", "detail_mix.mp3", "ì‹ ê³ "],
    ["ê°€ì§œì„ìœ ", "detail_fake.mp3", "ì‹ ê³ "],
    ["ì •ëŸ‰ê²€ì‚¬", "detail_measure.mp3", "ì ‘ìˆ˜"],
    ["LPG", "detail_lpg.mp3", "ì ‘ìˆ˜"],
    ["ì¼ë°˜ ëŒ€ë¦¬ì  ë“±ë¡Â·ë³€ê²½", "detail_agency.mp3", "ì ‘ìˆ˜"]
  ];

  showButtons(list.map(([name, audio, mode]) =>
    btn(name, ()=>selectDetail(name, audio, mode))
  ));
}

async function selectDetail(name, audio, mode){
  clearButtons();
  state.detail=name;
  state.mode=mode;

  await say(`${name} ${mode}ë¡œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ì ì—°ê²° ì¤‘ì…ë‹ˆë‹¤...`);
  await playAudio(audio);

  startRinging();
  showContactInput();
}

/* ----------------- ë‹´ë‹¹ì ì—°ê²° ----------------- */

function startRinging(){
  ringAudio = new Audio("./audio/ring.mp3");
  ringAudio.loop = true;
  ringAudio.volume = 0.45;
  ringAudio.play();
}

function showContactInput(){
  document.getElementById("inputArea").style.display="flex";

  showButtons([
    // ì •ìƒ ì ‘ìˆ˜ : ë…¹ìŒ ì—†ì´ ë°”ë¡œ ì¢…ë£Œ
    btn("âœ… ì ‘ìˆ˜ ì™„ë£Œ", ()=>finishCall("ok","no")),
    // í†µí™”ì¤‘/ë¶€ì¬ì¤‘ : ë…¹ìŒ í”Œë¡œìš°ë¡œ ì§„ì…
    btn("ğŸ“ í†µí™”ì¤‘/ë¶€ì¬ì¤‘", ()=>busyCall())
  ]);
}

/* ----------------- í†µí™”ì¤‘ / ë¶€ì¬ì¤‘ ----------------- */

async function busyCall(){
  if(ringAudio){ ringAudio.pause(); }
  clearButtons();
  document.getElementById("inputArea").style.display="none";

  await say("í˜„ì¬ ë‹´ë‹¹ìê°€ í†µí™”ì¤‘ì´ê±°ë‚˜ ë¶€ì¬ì¤‘ì…ë‹ˆë‹¤. ë…¹ìŒì„ ì›í•˜ì‹œë©´ ë…¹ìŒì„ ë§ì”€í•´ì£¼ì„¸ìš”.");
  await playAudio("busy_or_absent.mp3");

  // ë…¹ìŒ ì‹œì‘ / ë°”ë¡œ ì¢…ë£Œ ì„ íƒ
  showButtons([
    btn("ğŸ™ ë…¹ìŒ ì‹œì‘", ()=>startPseudoRecord()),
    btn("ğŸ“´ í†µí™” ì¢…ë£Œ", ()=>finishCall("busy","no"))
  ]);
}

async function startPseudoRecord(){
  clearButtons();

  // 1ì´ˆì§œë¦¬ ë²„ì €
  const beep = new Audio("./audio/record_beep.mp3");
  beep.volume = 0.5;
  beep.play();
  setTimeout(()=>beep.pause(),1000);

  await say("ë…¹ìŒì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");

  // ë…¹ìŒ ì¢…ë£Œ ë²„íŠ¼ë§Œ í‘œì‹œ (ì‹¤ì œ ë…¹ìŒì€ ì•ˆ í•¨, UIë§Œ)
  showButtons([
    btn("ğŸ›‘ ë…¹ìŒ ì¢…ë£Œ", ()=>stopPseudoRecord())
  ]);
}

async function stopPseudoRecord(){
  clearButtons();

  await say("ë…¹ìŒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
  await playAudio("record_end.mp3");

  // ë…¹ìŒ í›„ í†µí™” ì¢…ë£Œ ë²„íŠ¼
  showButtons([
    btn("ğŸ“´ í†µí™” ì¢…ë£Œ", ()=>finishCall("busy","yes"))
  ]);
}

/* ----------------- ì¢…ë£Œ ì²˜ë¦¬ ----------------- */

async function finishCall(status, recordFlag){
  if(ringAudio){ ringAudio.pause(); }
  clearButtons();
  document.getElementById("inputArea").style.display="none";

  await say("ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
  await playAudio("submit_end.mp3");

  openMessenger(status, recordFlag);
}

/* ----------------- ë©”ì‹ ì € ì—°ë™ ----------------- */

function openMessenger(status, recordFlag){
  const qs=new URLSearchParams({
    region: state.region || "",
    detail: state.detail || "ê¸°íƒ€ ë¬¸ì˜",
    mode: state.mode || "",
    status: status,          // ok / busy
    record: recordFlag,      // yes / no
    name: document.getElementById("userName").value || "í™ê¸¸ë™",
    phone: document.getElementById("userPhone").value || "010-0000-0000",
    addr: document.getElementById("userAddress").value || "ë¯¸ê¸°ì¬"
  });

  window.open("/messenger.html?"+qs.toString(), "_blank");
}
</script>
</body>
</html>






