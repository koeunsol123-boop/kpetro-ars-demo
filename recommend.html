<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>ğŸ“Š ì§‘ì¤‘ê´€ë¦¬ ì¶”ì²œ ì§€ì—­</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: system-ui,sans-serif; margin:40px auto; max-width:900px; }
    #map { height: 400px; margin-bottom:20px; border-radius:8px; }
    table { width:100%; border-collapse:collapse; }
    th,td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#0077ff; color:white; }
  </style>
</head>
<body>
  <h1>ğŸ“Š AI ARS ì§‘ì¤‘ê´€ë¦¬ ì¶”ì²œ ì§€ì—­</h1>
  <p>ìµœê·¼ ì‹ ê³  ë°ì´í„° ì¤‘ 2íšŒ ì´ìƒ ë°˜ë³µëœ ì§€ì—­Â·ì§€ì ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
  <div id="map"></div>
  <canvas id="chart" height="160"></canvas>
  <table id="table"><thead><tr><th>ì§€ì—­</th><th>ì‚¬ì—…ì¥</th><th>ì‹ ê³ íšŸìˆ˜</th></tr></thead><tbody></tbody></table>

  <script>
    const regionCoords = {
      "ë¶€ì‚°":[35.1796,129.0756],
      "ìš¸ì‚°":[35.5384,129.3114],
      "ê²½ë‚¨":[35.2372,128.6927],
      "ë¯¸ìƒì§€ì—­":[35.2,129.1]
    };

    const map = L.map('map').setView([35.1796,129.0756], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    fetch("/api/stats").then(r=>r.json()).then(({data})=>{
      const tbody = document.querySelector("#table tbody");
      const labels=[], counts=[];
      data.forEach(d=>{
        const coords = regionCoords[d.region] || [35.2,129];
        const color = d.count>=2 ? "red" : "blue";
        L.circleMarker(coords,{radius:10,color}).addTo(map)
          .bindPopup(`${d.region} ${d.name}<br>ì‹ ê³  ${d.count}íšŒ`);
        labels.push(`${d.region}-${d.name}`);
        counts.push(d.count);
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${d.region}</td><td>${d.name}</td><td>${d.count}</td>`;
        tbody.appendChild(tr);
      });

      new Chart(document.getElementById("chart"), {
        type:"bar",
        data:{labels,datasets:[{label:"ì‹ ê³ íšŸìˆ˜",data:counts,backgroundColor:"#0077ff"}]},
        options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
      });
    });
  </script>
</body>
</html>
